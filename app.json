[{"name": "app.py", "content": "from shiny import App, ui, render, reactive\n\napp_ui = ui.page_fluid(\n    ui.tags.head(\n        # Include Ruffle script from the CDN\n        ui.tags.script(src=\"https://unpkg.com/ruffle-nightly@latest/ruffle.js\"),\n    ),\n    ui.h2(\"ShinyLive Ruffle Integration\"),\n    ui.layout_sidebar(\n        ui.sidebar(\n            ui.input_select(\n                \"swf_file\",\n                \"Select SWF File\",\n                {\n                    \"PM.swf\": \"PM\",\n                },\n            ),\n            ui.input_action_button(\"load_swf\", \"Load SWF\"),\n        ),\n        ui.output_ui(\"swf_container\")\n    ),\n    # Inject JavaScript code to initialize Ruffle\n    ui.tags.script(\"\"\"\n    // Initialize Ruffle\n    (function() {\n        const ruffleReady = new Promise((resolve) => {\n            if (window.RufflePlayer) {\n                resolve();\n            } else {\n                const checkRuffle = setInterval(() => {\n                    if (window.RufflePlayer) {\n                        clearInterval(checkRuffle);\n                        resolve();\n                    }\n                }, 100);\n            }\n        });\n\n        ruffleReady.then(() => {\n            const rufflePlayer = window.RufflePlayer.newest();\n            window.player = null;\n\n            // Function to load SWF\n            window.loadSWF = function(swf_url) {\n                if (window.player) {\n                    window.player.remove();\n                }\n                const container = document.getElementById(\"swf-player\");\n                window.player = rufflePlayer.createPlayer();\n                container.appendChild(window.player);\n                window.player.load(swf_url);\n            };\n        });\n    })();\n    \"\"\"),\n)\n\ndef server(input, output, session):\n    @render.ui\n    def swf_container():\n        return ui.HTML(\"<div id='swf-player'></div>\")\n\n    @reactive.effect\n    @reactive.event(input.load_swf)\n    def _():\n        swf_file = input.swf_file()\n        # Encode the URL to handle spaces correctly\n        from urllib.parse import quote\n        encoded_file = quote(swf_file)\n        swf_url = f\"./swf/{encoded_file}\"\n        # Call JavaScript function to load SWF using session.send_custom_message\n        session.send_custom_message(\"loadSWF\", swf_url)\n\n    # Register custom message handler\n    ui.tags.script(\"\"\"\n        Shiny.addCustomMessageHandler('loadSWF', function(swf_url) {\n            window.loadSWF(swf_url);\n        });\n    \"\"\")\n\napp = App(app_ui, server)\n", "type": "text"}]